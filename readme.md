# Proxmox VM Control Bot

Этот проект представляет собой Telegram-бот, который упрощает управление виртуальными машинами на серверах Proxmox. Используя этот бот, вы можете управлять своими виртуальными машинами (VM), получая информацию о статусе VM, а также выполняя такие действия, как запуск, остановка и перезагрузка прямо через Telegram.

## Основные возможности

- Получение списка всех серверов Proxmox и виртуальных машин, находящихся на каждом сервере.
- Управление виртуальными машинами: запуск, остановка, перезагрузка.
- Получение статуса каждой виртуальной машины, включая использование ресурсов (CPU, память), и информацию о времени работы (uptime).
- Вывод логов операций Proxmox для каждой виртуальной машины.
- Быстрый доступ к узлам Proxmox с помощью Inline-клавиатуры в Telegram.

## Структура проекта

### 1. `proxmox.py`

Модуль, который:
- Подключается к Proxmox серверам через API.
- Получает данные о виртуальных машинах, включая их статус, использование ресурсов и uptime.
- Осуществляет действия с виртуальными машинами (запуск, остановка, перезагрузка).
- Преобразует данные uptime в человекочитаемый формат.

### 2. `pve_control_bot.py`

Telegram-бот на базе библиотеки `aiogram`, который:
- Предоставляет пользователям интерфейс для управления Proxmox серверами через чат.
- Обрабатывает команды и колбэки для получения информации о VM и управления ими.
- Использует inline-клавиатуру для быстрого выбора серверов и виртуальных машин.

## Как начать работу

### 1. Установка зависимостей

Установите необходимые библиотеки:
```bash
pip install -r requirements.txt

### 2. Создайте токен в pve, например через web интерфейс.
В разделе Datacenter
1. Создайте пользователя startstop_vm_bot в Datacenter/Permissions user
2. Создайте роль start_stop_vm_bot с правами: VM.Monitor, VM.Audit, VM.PowerMgmt, Sys.PowerMgmt, Sys.Audit в Datacenter/Permissions/Roles
3. Создайте токен start_stop_vm_bot  в Datacenter/Permissions/API Tokens
4. Добавьте права и пользователю и токену назначив созданную role в Datacenter/Permissions

### 3. Настройка конфигурации серверов
Создайте файл servers.json, где будет храниться информация о ваших серверах Proxmox, например:

(Есть файл пример servers_example.json, скопируйте его в servers.json и внесите изменения))
{
  "servers": [
    {
      "name": "Proxmox-1",
      "host": "proxmox1.example.com",
      "user": "root@pam",
      "token_name": "api-token",
      "token_value": "your-token-here"
    }
  ]
}
3. Переменные окружения
Создайте файл .env и добавьте в него ваш токен бота и telegram id разрешенных пользователей (можно получить через @myidbot):

BOT_TOKEN=your-telegram-bot-token
ALLOWED_USERS=111111,2222222

### 4. Запуск
Запустите бота:

python pve_control_bot.py
Теперь бот будет работать и управлять вашими виртуальными машинами.

Использование
Команды
/start — Инициализирует бота, отображает список серверов Proxmox.
или нажмите на клавиатуре "Список PVE серверов" — Отправляет клавиатуру для выбора сервера.
Управление VM — После выбора сервера, вы увидите список виртуальных машин на нём, а также кнопки для управления каждой VM (старт, остановка, перезагрузка).
Пример работы
Вы вводите команду /start.
Выбираете сервер из списка.
Получаете список всех VM на сервере с их статусами и метриками.
Выбираете VM для управления и выполняете действия через Inline-кнопки.

Команды перезагрузка, остановка, запуск будут сразу отправленны на сервер, без дополнительных предупреждений.



